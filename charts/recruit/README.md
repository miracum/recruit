# recruIT

[recruIT](https://miracum.github.io/recruit) - Helm chart for deploying the recruIT clinical trial recruitment support system on Kubernetes.

## TL;DR;

```console
$ helm repo add miracum https://miracum.github.io/charts
$ helm repo update
$ helm install recruit miracum/recruit -n recruit
```

You can find more exhaustive documentation at the recruIT documentation site: <https://miracum.github.io/recruit/deployment/kubernetes>.

## Introduction

This chart deploys the recruIT clinical trial recruitment support system on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Prerequisites

- Kubernetes v1.21+
- Helm v3.8+

## Upgrades & Breaking Changes

See [UPGRADING.md](./docs/UPGRADING.md) for information on breaking changes introduced by major version bumps and instructions on how to update.

## Installing the Chart

To install the chart with the release name `recruit`:

```console
$ helm install recruit miracum/recruit -n recruit
```

The command deploys the recruIT clinical trial recruitment support system on the Kubernetes cluster in the default configuration. The [configuration](#configuration) section lists the parameters that can be configured during installation.

> **Tip**: List all releases using `helm list`

## Uninstalling the Chart

To uninstall/delete the `recruit`:

```console
$ helm delete recruit -n recruit
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

## Configuration

The following table lists the configurable parameters of the `recruit` chart and their default values.

| Parameter                                            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Default                                                        |
| ---------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------- |
| imagePullSecrets                                     | image pull secrets used by all pods                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>[]</code>                                                |
| nameOverride                                         | partially override the release name                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>""</code>                                                |
| fullnameOverride                                     | fully override the release name                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>""</code>                                                |
| deploymentAnnotations                                | Annotations to set on all Deployment resources                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                |
| podAnnotations                                       | Annotations to set on all Pod resources                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>{}</code>                                                |
| extraLabels                                          | additionally labels to apply to all deployments                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                |
| fhirserver.enabled                                   | Whether the included HAPI FHIR server should be used See <https://github.com/hapifhir/hapi-fhir-jpaserver-starter/tree/master/charts/hapi-fhir-jpaserver#values> for options.                                                                                                                                                                                                                                                                                      | <code>true</code>                                              |
| fhirserver.postgresql.nameOverride                   | overrides the chart's postgres server name to avoid conflicts with the included ohdsi chart                                                                                                                                                                                                                                                                                                                                                                        | <code>"fhir-server-postgres"</code>                            |
| fhirserver.networkPolicy.enabled                     | if enabled, access to the included FHIR server is limited to pods with the required labels. If set to `true`, all pods of the recruIT chart will be automatically configured to be able to access the server.                                                                                                                                                                                                                                                      | <code>false</code>                                             |
| externalFhirServer.url                               | URL of an external FHIR Server - only used when `fhirserver.enabled` is set to `false`                                                                                                                                                                                                                                                                                                                                                                             | <code>""</code>                                                |
| mailhog.enabled                                      | Whether the included SMTP test server should be used. Not required for a production deployment. See <https://github.com/codecentric/helm-charts/blob/master/charts/mailhog/values.yaml> for available options.                                                                                                                                                                                                                                                     | <code>true</code>                                              |
| mailhog.containerSecurityContext.runAsNonRoot        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>true</code>                                              |
| mailhog.containerSecurityContext.seccompProfile.type |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>RuntimeDefault</code>                                    |
| ohdsi.enabled                                        | Whether the included OHDSI chart should be installed. See <https://github.com/chgl/charts/tree/master/charts/ohdsi/values.yaml> for available options.                                                                                                                                                                                                                                                                                                             | <code>true</code>                                              |
| ohdsi.postgresql.nameOverride                        | overrides the chart's postgres server name to avoid conflicts with the included HAPI FHIR server chart                                                                                                                                                                                                                                                                                                                                                             | <code>"ohdsi-postgres"</code>                                  |
| ohdsi.cdmInitJob.enabled                             | to make sure the job runs only once, set this to `false` after the first installation completed                                                                                                                                                                                                                                                                                                                                                                    | <code>false</code>                                             |
| query.enabled                                        | Whether the query module should be enabled                                                                                                                                                                                                                                                                                                                                                                                                                         | <code>true</code>                                              |
| query.replicaCount                                   | Number of replicas of the query module to run. Running more than one replica for this component is discouraged.                                                                                                                                                                                                                                                                                                                                                    | <code>1</code>                                                 |
| query.revisionHistoryLimit                           | specify how many old ReplicaSets for this Deployment you want to retain.                                                                                                                                                                                                                                                                                                                                                                                           | <code>5</code>                                                 |
| query.metrics.serviceMonitor.enabled                 | if enabled, creates a ServiceMonitor instance for Prometheus Operator-based monitoring                                                                                                                                                                                                                                                                                                                                                                             | <code>false</code>                                             |
| query.metrics.serviceMonitor.additionalLabels        | additional labels to apply the the ServiceMonitor object, eg. `release: prometheus`                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                |
| query.extraEnv                                       | extra environment vars on the container                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>[]</code>                                                |
| query.extraPodLabels                                 | specify additional labels to apply to the query pod                                                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                |
| query.service.type                                   | the service type                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>ClusterIP</code>                                         |
| query.service.port                                   | the service port for the HTTP endpoint                                                                                                                                                                                                                                                                                                                                                                                                                             | <code>8080</code>                                              |
| query.service.metricsPort                            | the service port for the actuator/metrics endpoint                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>8081</code>                                              |
| query.webAPI.url                                     | URL of the ATLAS WebAPI endpoint. Usually ends in /WebAPI.                                                                                                                                                                                                                                                                                                                                                                                                         | <code>"http://example:8080/WebAPI"</code>                      |
| query.webAPI.dataSource                              | name of the OMOP datasource used to generate the cohorts from.                                                                                                                                                                                                                                                                                                                                                                                                     | <code>"CDS-CDMV5"</code>                                       |
| query.webAPI.auth.enabled                            | set to true if the WebAPI requires authentication to access                                                                                                                                                                                                                                                                                                                                                                                                        | <code>false</code>                                             |
| query.webAPI.auth.loginPath                          | the login method/path to use. See <https://github.com/OHDSI/Atlas/blob/master/js/config/app.js#L20> for a list of possible values                                                                                                                                                                                                                                                                                                                                  | <code>"/user/login/db"</code>                                  |
| query.webAPI.auth.username                           | the username to login as. Note that this user needs permissions to query and generate cohorts                                                                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                                |
| query.webAPI.auth.password                           | the password used for login.                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>""</code>                                                |
| query.webAPI.auth.existingSecret.name                | name of an existing Kubernetes secret that contains the user password                                                                                                                                                                                                                                                                                                                                                                                              | <code>""</code>                                                |
| query.webAPI.auth.existingSecret.key                 | the key containing the password                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>"webApiAuthPassword"</code>                              |
| query.schedule                                       | A UNIX cron expression defining the execution schedule of the query module                                                                                                                                                                                                                                                                                                                                                                                         | <code>"_/5 _ \* \* \*"</code>                                  |
| query.omop.host                                      | hostname of the OHDSI OMOP db                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>"localhost"</code>                                       |
| query.omop.port                                      | port of the db                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>5432</code>                                              |
| query.omop.database                                  | name of the db                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>OHDSI</code>                                             |
| query.omop.username                                  | username to access the db                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>postgres</code>                                          |
| query.omop.password                                  | password to access the db                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>postgres</code>                                          |
| query.omop.existingSecret                            | name of an existing secret to use instead of `omop.password`. Must include an `omop-password` key.                                                                                                                                                                                                                                                                                                                                                                 | <code>""</code>                                                |
| query.omop.resultsSchema                             | Name of the database schema containing the results of the cohort generation                                                                                                                                                                                                                                                                                                                                                                                        | <code>cds_results</code>                                       |
| query.omop.cdmSchema                                 | Name of the database schema containing the actual clinical data                                                                                                                                                                                                                                                                                                                                                                                                    | <code>cds_cdm</code>                                           |
| query.shouldWaitForNotify                            | whether the query module should wait for the notification module to be up before starting. implemented as an init container that waits on notify's `/actuator/health` endpoint                                                                                                                                                                                                                                                                                     | <code>false</code>                                             |
| query.resources                                      | resource requests and limits for the container                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                |
| query.nodeSelector                                   | node labels for pod assignment see: <https://kubernetes.io/docs/user-guide/node-selection/>                                                                                                                                                                                                                                                                                                                                                                        | <code>{}</code>                                                |
| query.tolerations                                    | tolerations for pod assignment see: <https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>                                                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                                |
| query.affinity                                       | affinity for pod assignment see: <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity>                                                                                                                                                                                                                                                                                                                                   | <code>{}</code>                                                |
| query.podSecurityContext                             | security context for the pod                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>{}</code>                                                |
| query.topologySpreadConstraints                      | pod topology spread configuration see: https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/#api                                                                                                                                                                                                                                                                                                                                     | <code>[]</code>                                                |
| notify.enabled                                       | Whether the notification module should be enabled                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>true</code>                                              |
| notify.replicaCount                                  | number of replicas for the notify component. should only be set to a number > 1 if `notify.ha.enabled=true`                                                                                                                                                                                                                                                                                                                                                        | <code>1</code>                                                 |
| notify.revisionHistoryLimit                          | specify how many old ReplicaSets for this Deployment you want to retain.                                                                                                                                                                                                                                                                                                                                                                                           | <code>5</code>                                                 |
| notify.metrics.serviceMonitor.enabled                | if enabled, creates a ServiceMonitor instance for Prometheus Operator-based monitoring                                                                                                                                                                                                                                                                                                                                                                             | <code>false</code>                                             |
| notify.metrics.serviceMonitor.additionalLabels       | additional labels to set on the ServiceMonitor object, e.g. `release: prometheus-operator`                                                                                                                                                                                                                                                                                                                                                                         | <code>{}</code>                                                |
| notify.extraEnv                                      | extra environment vars on the container                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>[]</code>                                                |
| notify.extraPodLabels                                | specify additional labels to apply to the notify pod                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                |
| notify.mail.server.host                              | Hostname of the external SMTP mail server                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>""</code>                                                |
| notify.mail.server.port                              | Mailserver port                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>25</code>                                                |
| notify.mail.server.username                          | Mailserver username                                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>""</code>                                                |
| notify.mail.server.password                          | Mailserver password                                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>""</code>                                                |
| notify.mail.server.existingSecret                    | Name of an existing secret containing an `smtp-password` key to use instead of the password value above                                                                                                                                                                                                                                                                                                                                                            | <code>""</code>                                                |
| notify.mail.screeningListLinkTemplate                | Used to link back to the screening list web app from an email. If the screening list ingress is enabled, it uses list.ingress.hosts.host to construct the URL, otherwise uses this value. Should include a '[list_id]' which is replaced with the internal screening list id.                                                                                                                                                                                      | <code>"http://localhost:8080/recommendations/[list_id]"</code> |
| notify.mail.from                                     | The sender email address for the created notification mails.                                                                                                                                                                                                                                                                                                                                                                                                       | <code>"recruit@example.com"</code>                             |
| notify.ha.enabled                                    | whether to enable high-availability mode for the notification module                                                                                                                                                                                                                                                                                                                                                                                               | <code>false</code>                                             |
| notify.ha.database.host                              | hostname for the database used to store notification jobs if `postgresql.enabled=true`, uses the included PostgreSQL database instead.                                                                                                                                                                                                                                                                                                                             | <code>""</code>                                                |
| notify.ha.database.port                              | database port                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>5432</code>                                              |
| notify.ha.database.username                          | username to log into the database                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>""</code>                                                |
| notify.ha.database.password                          | password for the database                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>""</code>                                                |
| notify.ha.database.name                              | database name                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>"recruit_notify_jobstore"</code>                         |
| notify.ha.database.existingSecret.name               | name of an existing Kubernetes secret from which to retrieve the user's password.                                                                                                                                                                                                                                                                                                                                                                                  | <code>""</code>                                                |
| notify.ha.database.existingSecret.key                | key inside the existing secret                                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>"postgresql-password"</code>                             |
| notify.podDisruptionBudget.enabled                   | uses policy/v1 of the PodDisruptionBudget resource requiring Kubernetes 1.21+                                                                                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                             |
| notify.podDisruptionBudget.minAvailable              | Minimum available instances; ignored if there is no PodDisruptionBudget                                                                                                                                                                                                                                                                                                                                                                                            | <code>1</code>                                                 |
| notify.podDisruptionBudget.maxUnavailable            | Maximum unavailable instances; ignored if there is no PodDisruptionBudget                                                                                                                                                                                                                                                                                                                                                                                          | <code>""</code>                                                |
| notify.rules                                         | Configure the Notification rules. See the [Configure Notifcation Rules](#configure-notifcation-rules) section below.                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                |
| notify.service.type                                  | service type                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>ClusterIP</code>                                         |
| notify.service.port                                  | service port for the HTTP endpoint                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>8080</code>                                              |
| notify.service.metricsPort                           | service port for the actuator/metrics endpoint                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>8081</code>                                              |
| notify.ingress.enabled                               | if enabled, this ingress is used when setting up the webhook subscription in the FHIR server. Setting this ingress is useful if the FHIR server is external to the cluster and can only be reached via this ingress. The URL called by the external FHIR server with ingress enabled is as follows: "http(s)://ingress.hosts[0].host/on-list-change" If ingress.enabled is false, then the notify.service is used to construct the URL invoked by the FHIR server. | <code>false</code>                                             |
| notify.ingress.ingressClassName                      | name of the IngressClass resource to use for this ingress                                                                                                                                                                                                                                                                                                                                                                                                          | <code>""</code>                                                |
| notify.ingress.annotations                           | additional annotations for the Ingress resource                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                |
| notify.ingress.tls                                   | TLS configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>[]</code>                                                |
| notify.resources                                     | resource requests and limits for the container                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                |
| notify.nodeSelector                                  | node labels for pod assignment see: <https://kubernetes.io/docs/user-guide/node-selection/>                                                                                                                                                                                                                                                                                                                                                                        | <code>{}</code>                                                |
| notify.tolerations                                   | tolerations for pod assignment see: <https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>                                                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                                |
| notify.affinity                                      | affinity for pod assignment see: <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity>                                                                                                                                                                                                                                                                                                                                   | <code>{}</code>                                                |
| notify.topologySpreadConstraints                     | pod topology spread configuration see: https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/#api                                                                                                                                                                                                                                                                                                                                     | <code>[]</code>                                                |
| notify.podSecurityContext                            | security context for the pod                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>{}</code>                                                |
| list.enabled                                         | Whether the list module should be enabled                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>true</code>                                              |
| list.replicaCount                                    | Number of replicas for the list module. A fault-tolerant number of replicas is recommended.                                                                                                                                                                                                                                                                                                                                                                        | <code>1</code>                                                 |
| list.revisionHistoryLimit                            | specify how many old ReplicaSets for this Deployment you want to retain.                                                                                                                                                                                                                                                                                                                                                                                           | <code>5</code>                                                 |
| list.service.type                                    | service type                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>ClusterIP</code>                                         |
| list.service.port                                    | service port                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>8080</code>                                              |
| list.auth.enabled                                    | if enabled, requires authentication before accessing the screening list                                                                                                                                                                                                                                                                                                                                                                                            | <code>false</code>                                             |
| list.auth.keycloak.clientId                          | the Keycloak client id                                                                                                                                                                                                                                                                                                                                                                                                                                             | <code>"uc1-screeninglist"</code>                               |
| list.auth.keycloak.realm                             | the Keycloak realm                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>"MIRACUM"</code>                                         |
| list.auth.keycloak.url                               | the Keycloak auth URL. Should end in `/auth`.                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>"http://localhost:8083/auth"</code>                      |
| list.dePseudonymization.enabled                      | if enabled, all FHIR resource will first be processed by the fhir-pseudonymizer for de-pseudonymization before being displayed.                                                                                                                                                                                                                                                                                                                                    | <code>false</code>                                             |
| list.dePseudonymization.serviceUrl                   | API base URL of the FHIR pseudonymizer to use. If `fhir-pseudonymizer.enabled` is set to `true`, this URL will be auto-configured.                                                                                                                                                                                                                                                                                                                                 | <code>"http://fhir-pseudonymizer:8080/fhir"</code>             |
| list.dePseudonymization.apiKey                       | the API key to invoke the FHIR pseudonymizer                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>""</code>                                                |
| list.dePseudonymization.existingApiKeySecret.name    | name of an existing Kubernetes Secret that contains the API key. Leave empty to use `dePseudonymization.apiKey` instead.                                                                                                                                                                                                                                                                                                                                           | <code>""</code>                                                |
| list.dePseudonymization.existingApiKeySecret.key     | key of the Kubernetes Secret that contains the API key                                                                                                                                                                                                                                                                                                                                                                                                             | <code>"fhir-pseudonymizer-api-key"</code>                      |
| list.metrics.serviceMonitor.enabled                  | if enabled, creates a ServiceMonitor instance for Prometheus Operator-based monitoring                                                                                                                                                                                                                                                                                                                                                                             | <code>false</code>                                             |
| list.metrics.serviceMonitor.additionalLabels         | additional labels                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>{}</code>                                                |
| list.extraEnv                                        | specify extra environment vars on the container                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>[]</code>                                                |
| list.extraPodLabels                                  | specify additional labels to apply to the list pod                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>{}</code>                                                |
| list.ingress.enabled                                 | if enabled, create an ingress resource to access the screening list                                                                                                                                                                                                                                                                                                                                                                                                | <code>false</code>                                             |
| list.ingress.ingressClassName                        | name of the IngressClass resource to use for this ingress                                                                                                                                                                                                                                                                                                                                                                                                          | <code>""</code>                                                |
| list.ingress.annotations                             | additional annotations for the Ingress resource                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                |
| list.ingress.tls                                     | TLS configuration                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>[]</code>                                                |
| list.podDisruptionBudget.enabled                     | uses policy/v1 of the PodDisruptionBudget resource requiring Kubernetes 1.21+                                                                                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                             |
| list.podDisruptionBudget.minAvailable                | Minimum available instances; ignored if there is no PodDisruptionBudget                                                                                                                                                                                                                                                                                                                                                                                            | <code>1</code>                                                 |
| list.podDisruptionBudget.maxUnavailable              | Maximum unavailable instances; ignored if there is no PodDisruptionBudget                                                                                                                                                                                                                                                                                                                                                                                          | <code>""</code>                                                |
| list.resources                                       | resource requests and limits for the container                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                |
| list.nodeSelector                                    | node labels for pod assignment see: <https://kubernetes.io/docs/user-guide/node-selection/>                                                                                                                                                                                                                                                                                                                                                                        | <code>{}</code>                                                |
| list.tolerations                                     | tolerations for pod assignment see: <https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/>                                                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                                |
| list.affinity                                        | affinity for pod assignment see: <https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity>                                                                                                                                                                                                                                                                                                                                   | <code>{}</code>                                                |
| list.podSecurityContext                              | security context for the pod                                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>{}</code>                                                |
| list.topologySpreadConstraints                       | pod topology spread configuration see: https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/#api                                                                                                                                                                                                                                                                                                                                     | <code>[]</code>                                                |
| postgresql.enabled                                   | enable the included postgres DB, currently used only by the notification module to store jobs when running in high-availability mode (`notify.ha.enabled=true`)                                                                                                                                                                                                                                                                                                    | <code>false</code>                                             |
| postgresql.nameOverride                              | override the default name to avoid conflicts with the HAPI and OHDSI charts                                                                                                                                                                                                                                                                                                                                                                                        | <code>"recruit-postgres"</code>                                |
| postgresql.auth.database                             | set the default database name to `recruit`                                                                                                                                                                                                                                                                                                                                                                                                                         | <code>"recruit"</code>                                         |
| fhir-pseudonymizer.enabled                           | install the included fhir-pseudonymizer chart. If set to `true`, the list module is auto-configured to use this service.                                                                                                                                                                                                                                                                                                                                           | <code>false</code>                                             |
| fhir-pseudonymizer.pseudonymizationService           | default to using Vfps as a pseudonym service. It is included as a dependency of the fhir-pseudonymizer.                                                                                                                                                                                                                                                                                                                                                            | <code>Vfps</code>                                              |
| fhir-pseudonymizer.vfps.enabled                      | enable the included Vfps service.                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>true</code>                                              |
| broadseaAtlasdb.enabled                              | whether to deploy the OHDSI Broadsea Atlasdb (<https://github.com/OHDSI/Broadsea-Atlasdb>) currently only used by internal integration tests. See [./values-integrationtest.yaml](values-integrationtest.yaml)                                                                                                                                                                                                                                                     | <code>false</code>                                             |

Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example:

```console
$ helm install recruit miracum/recruit -n recruit --set fhirserver.postgresql.nameOverride="fhir-server-postgres"
```

Alternatively, a YAML file that specifies the values for the parameters can be provided while
installing the chart. For example:

```console
$ helm install recruit miracum/recruit -n recruit --values values.yaml
```

## Configure Notifcation Rules

The notification rules can be directly configured inside your values.yaml. For example:

```yaml
notify:
  enabled: true
  rules:
    # create custom notification schedules using https://www.cronmaker.com
    # these are later referenced used when configuring the notification frequency per user.
    # Note that the user will only receive an email notification if the scheduled time has been
    # reached _and_ there has been a _new_ patient recommendation since the last one.An identical
    # email won't be relentlessly sent everyMorning/Monday/Hour etc...
    schedules:
      everyMorning: "0 0 8 1/1 * ? *"
      everyMonday: "0 0 8 ? * MON *"
      everyHour: "0 0 0/1 1/1 * ? *"
      everyFiveMinutes: "0 0/5 * 1/1 * ? *"

    # trials are identified by their acronym which corresponds to the cohort's title in Atlas or the "[acronym=XYZ]" tag
    trials:
      # a value of '*' matches every trial, so 'everything@example.com' will receive an email whenever any screeninglist
      # gets updated.
      - acronym: "*"
        subscriptions:
          - email: "everything@example.com"

      - acronym: "SAMPLE"
        # the new "accessibleBy" key allows specifying users either by username or email address that
        # are allowed to access the screening list
        accessibleBy:
          users:
            - "user1"
            - "user.two@example.com"
        subscriptions:
          - email: "everyMorning@example.com"
            # each 'notify'-value corresponds to one schedule
            notify: "everyMorning"
            # a lack of a 'notify'-key with an associated schedule means that the user will be notified immediately.
          - email: "immediately-sample@example.com"
            # For example, the following entry means that if the 'SAMPLE' trial received new screening recommendations,
            # an email is sent to 'everyMonday@example.com' on the next monday. This is useful for aggregating notifications
            # about screening recommendations.
          - email: "everyMonday@example.com"
            notify: "everyMonday"

      - acronym: "AMICA"
        subscriptions:
          - email: "immediately-amica@example.com"
          - email: "everyHour1@example.com"
            notify: "everyHour"
          - email: "everyHour2@example.com"
            notify: "everyHour"
          - email: "everyFiveMinutes@example.com"
            notify: "everyFiveMinutes"
```

## Distributed Tracing

See the documentation on distributed tracing for more information: <https://miracum.github.io/recruit/deployment/kubernetes/#distributed-tracing>.
